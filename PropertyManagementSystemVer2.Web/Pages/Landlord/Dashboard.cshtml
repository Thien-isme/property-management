@page
@model PropertyManagementSystemVer2.Web.Pages.Landlord.DashboardModel
@{
    ViewData["Title"] = "Dashboard Ch·ªß nh√†";
}

<div class="mb-20">
    <div class="page-title">Dashboard Ch·ªß nh√†</div>
    <div class="page-desc">T·ªïng quan c√°c b·∫•t ƒë·ªông s·∫£n b·∫°n ƒëang cho thu√™</div>
</div>

<div class="stat-grid">
    <div class="stat-card">
        <div class="stat-icon purple"><i data-feather="home"></i></div>
        <div class="stat-info">
            <div class="stat-label">T·ªïng BDS</div>
            <div class="stat-value">@Model.DashboardData?.TotalProperties</div>
            <div class="stat-change up">Ho·∫°t ƒë·ªông</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon green"><i data-feather="percent"></i></div>
        <div class="stat-info">
            <div class="stat-label">T·ª∑ l·ªá l·∫•p ƒë·∫ßy</div>
            <div class="stat-value">@((Model.DashboardData?.OccupancyRate ?? 0).ToString("0.0"))%</div>
            <div class="stat-change up">M·ª©c t·ªët</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon yellow"><i data-feather="dollar-sign"></i></div>
        <div class="stat-info">
            <div class="stat-label">Doanh thu th√°ng n√†y</div>
            <div class="stat-value">@Model.DashboardData?.MonthlyRevenue.ToString("N0") VNƒê</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon blue"><i data-feather="credit-card"></i></div>
        <div class="stat-info">
            <div class="stat-label">Thanh to√°n ch·ªù x·ª≠ l√Ω</div>
            <div class="stat-value">@Model.DashboardData?.PendingPayments.ToString("N0") VNƒê</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon red"><i data-feather="tool"></i></div>
        <div class="stat-info">
            <div class="stat-label">B·∫£o tr√¨ ƒëang m·ªü</div>
            <div class="stat-value">@Model.DashboardData?.ActiveMaintenanceRequests</div>
            <div class="stat-change text-red">C·∫ßn x·ª≠ l√Ω</div>
        </div>
    </div>
</div>

<div class="grid-2 mb-20">
    <!-- Chart -->
    <div class="card">
        <div class="card-header"><div class="card-title">Xu h∆∞·ªõng doanh thu (12 th√°ng g·∫ßn nh·∫•t)</div></div>
        <div style="height: 250px;">
            <canvas id="landlordRevenueChart"></canvas>
        </div>
    </div>

    <!-- T√¨nh tr·∫°ng BDS -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">T√¨nh tr·∫°ng BDS</div>
        </div>
        <div class="empty-state">
            <div class="empty-icon">üè¢</div>
            <p>D·ªØ li·ªáu Property s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã t·∫°i ƒë√¢y.</p>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var trendData = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.DashboardData?.RevenueTrend ?? new List<PropertyManagementSystemVer2.BLL.DTOs.MonthlyRevenueDto>()));
            
            var labels = trendData.map(d => d.Month + '/' + d.Year);
            var data = trendData.map(d => d.Revenue);

            // Dummy data if API empty
            if (data.length === 0) {
                labels = ['01/2026', '02/2026', '03/2026'];
                data = [5000000, 8000000, 12000000];
            }

            var ctx = document.getElementById('landlordRevenueChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Doanh thu (VND)',
                        data: data,
                        backgroundColor: '#10b981',
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { 
                            beginAtZero: true, 
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#8b97b4' }
                        },
                        x: { 
                            grid: { display: false },
                            ticks: { color: '#8b97b4' }
                        }
                    }
                }
            });
        });
    </script>
}
