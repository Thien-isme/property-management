@page
@model PropertyManagementSystemVer2.Web.Pages.Tenant.DashboardModel
@{
    ViewData["Title"] = "Dashboard Ng∆∞·ªùi thu√™";
}

<div class="mb-20">
    <div class="page-title">Dashboard Ng∆∞·ªùi thu√™</div>
    <div class="page-desc">T·ªïng quan t√¨nh tr·∫°ng thu√™ nh√† c·ªßa b·∫°n</div>
</div>

<div class="stat-grid">
    <div class="stat-card">
        <div class="stat-icon green"><i data-feather="file-text"></i></div>
        <div class="stat-info">
            <div class="stat-label">H·ª£p ƒë·ªìng hi·ªán t·∫°i</div>
            <div class="stat-value" style="font-size: 16px;">@(Model.DashboardData?.ActiveLease?.LeaseNumber ?? "‚Äî")</div>
            <div class="stat-change">
                @if (Model.DashboardData?.ActiveLease != null)
                {
                    @($"H·∫øt h·∫°n {Model.DashboardData.ActiveLease.EndDate:dd/MM/yyyy}")
                }
                else
                {
                    <text>Kh√¥ng c√≥ Hƒê hi·ªáu l·ª±c</text>
                }
            </div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon yellow"><i data-feather="credit-card"></i></div>
        <div class="stat-info">
            <div class="stat-label">Thanh to√°n ti·∫øp theo</div>
            <div class="stat-value" style="font-size: 18px;">
                @(Model.DashboardData?.NextPayment != null ? Model.DashboardData.NextPayment.Amount.ToString("N0") : "‚Äî")
            </div>
            <div class="stat-change @(Model.DashboardData?.NextPayment != null ? "down" : "")">
                @(Model.DashboardData?.NextPayment != null ? $"ƒê·∫øn h·∫°n {Model.DashboardData.NextPayment.DueDate:dd/MM/yyyy}" : "Kh√¥ng c√≥")
            </div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon red"><i data-feather="tool"></i></div>
        <div class="stat-info">
            <div class="stat-label">B·∫£o tr√¨ ƒëang m·ªü</div>
            <div class="stat-value">@(Model.DashboardData?.OpenMaintenanceRequests ?? 0)</div>
            <div class="stat-change">@(Model.DashboardData?.OpenMaintenanceRequests > 0 ? "ƒêang x·ª≠ l√Ω" : "T·∫•t c·∫£ ·ªïn")</div>
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon blue"><i data-feather="calendar"></i></div>
        <div class="stat-info">
            <div class="stat-label">L·ªãch xem nh√†</div>
            <div class="stat-value">@(Model.DashboardData?.UpcomingBookings?.Count ?? 0)</div>
            <div class="stat-change">S·∫Øp t·ªõi</div>
        </div>
    </div>
</div>

<div class="grid-2 mb-24">
    <!-- Active Lease Card -->
    <div class="card">
        <div class="card-header">
            <div class="card-title">üè† H·ª£p ƒë·ªìng ƒëang thu√™</div>
            @if (Model.DashboardData?.ActiveLease != null)
            {
                <span class="badge badge-success">Hi·ªáu l·ª±c</span>
            }
        </div>
        @if (Model.DashboardData?.ActiveLease != null)
        {
            var lease = Model.DashboardData.ActiveLease;
            <div>
                <div style="padding: 16px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 12px;">
                    <div class="fw-700" style="font-size: 16px; color: var(--accent-light); margin-bottom: 4px;">@lease.PropertyTitle</div>
                </div>
                <div class="info-row"><span class="info-label">M√£ h·ª£p ƒë·ªìng</span><span class="info-value fw-600">@lease.LeaseNumber</span></div>
                <div class="info-row"><span class="info-label">Ch·ªß nh√†</span><span class="info-value">@lease.LandlordName</span></div>
                <div class="info-row"><span class="info-label">Ti·ªÅn thu√™/th√°ng</span><span class="info-value text-green fw-700">@lease.MonthlyRent.ToString("N0") VNƒê</span></div>
                <div class="info-row"><span class="info-label">Th·ªùi h·∫°n</span><span class="info-value">@lease.StartDate.ToString("dd/MM/yyyy") ‚Üí @lease.EndDate.ToString("dd/MM/yyyy")</span></div>
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">üìÑ</div>
                <p>B·∫°n ch∆∞a c√≥ h·ª£p ƒë·ªìng n√†o ƒëang hi·ªáu l·ª±c</p>
                <a href="/Tenant/Search" class="btn btn-primary mt-16">T√¨m ki·∫øm BDS</a>
            </div>
        }
    </div>

    <!-- Next Payment -->
    <div class="card">
        <div class="card-header"><div class="card-title">üí≥ Thanh to√°n s·∫Øp ƒë·∫øn h·∫°n</div></div>
        @if (Model.DashboardData?.NextPayment != null)
        {
            var payment = Model.DashboardData.NextPayment;
            <div>
                <div style="text-align: center; padding: 20px; background: var(--bg-primary); border-radius: 8px; margin-bottom: 16px;">
                    <div class="text-muted text-sm mb-8">S·ªë ti·ªÅn c·∫ßn thanh to√°n</div>
                    <div style="font-size: 32px; font-weight: 800; color: var(--warning);">@payment.Amount.ToString("N0") VNƒê</div>
                    <div class="mt-8 text-muted">ƒê·∫øn h·∫°n @payment.DueDate.ToString("dd/MM/yyyy")</div>
                    <div class="mt-4"><span class="badge badge-warning">Ch∆∞a thanh to√°n</span></div>
                </div>
                <div class="info-row"><span class="info-label">M√¥ t·∫£</span><span class="info-value">@payment.Description</span></div>
                <div style="margin-top: 16px; display: flex; gap: 10px;">
                    <button class="btn btn-primary" style="flex: 1;">üí≥ Thanh to√°n ngay</button>
                </div>
            </div>
        }
        else
        {
            <div class="empty-state">
                <div class="empty-icon">‚úÖ</div>
                <p>Kh√¥ng c√≥ thanh to√°n n√†o s·∫Øp ƒë·∫øn h·∫°n</p>
            </div>
        }
    </div>
</div>
